<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CS559 Game - Prototype</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #202020;
      color: white;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    #overlay {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.5);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      z-index: 10;
    }
    canvas { display: block; }
  </style>
</head>
<body>
<div id="overlay">
  <div><strong>CS559 Prototype Mode</strong></div>
  <div>W A S D: move the red ball</div>
  <div>Mouse: rotate view</div>
</div>

<canvas id="three-canvas"></canvas>

<!-- 下面开始是游戏代码 -->
<script type="module">
  // 从 CDN 引入 THREE.js 和 OrbitControls（不用自己下文件）
  import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js';
  import { OrbitControls } from 'https://unpkg.com/three@0.158.0/examples/jsm/controls/OrbitControls.js';

  // === 基本场景 ===
  const canvas   = document.getElementById('three-canvas');
  const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x202020);

  const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  );
  camera.position.set(8, 8, 12);

  // 光照（虽然用的是 BasicMaterial，但以后 Full 模式会用到）
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(10, 20, 10);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0xffffff, 0.3));

  // 视角控制
  const controls = new OrbitControls(camera, renderer.domElement);

  // === 地面：纯几何体，无纹理（符合 Prototype 要求）===
  const planeGeo = new THREE.PlaneGeometry(40, 40);
  const planeMat = new THREE.MeshBasicMaterial({
    color: 0x444444,
    side: THREE.DoubleSide
  });
  const plane = new THREE.Mesh(planeGeo, planeMat);
  plane.rotation.x = -Math.PI / 2;
  scene.add(plane);

  // === 玩家：红色小球（可移动）===
  const playerGeo = new THREE.SphereGeometry(1, 16, 16);
  const playerMat = new THREE.MeshBasicMaterial({ color: 0xff5555 });
  const player = new THREE.Mesh(playerGeo, playerMat);
  player.position.set(0, 1, 0);
  scene.add(player);

  // 随便摆几个方块障碍物（也是 primitive）
  const boxGeo = new THREE.BoxGeometry(2, 2, 2);
  for (let i = 0; i < 8; i++) {
    const m = new THREE.MeshBasicMaterial({ color: 0x55aaff });
    const box = new THREE.Mesh(boxGeo, m);
    box.position.set(
      (Math.random() - 0.5) * 30,
      1,
      (Math.random() - 0.5) * 30
    );
    scene.add(box);
  }

  // === 键盘控制 ===
  const keys = {};
  window.addEventListener('keydown', (e) => {
    keys[e.key.toLowerCase()] = true;
  });
  window.addEventListener('keyup', (e) => {
    keys[e.key.toLowerCase()] = false;
  });

  function updatePlayer() {
    const speed = 0.15;
    let vx = 0, vz = 0;

    if (keys['w']) vz -= speed;
    if (keys['s']) vz += speed;
    if (keys['a']) vx -= speed;
    if (keys['d']) vx += speed;

    player.position.x += vx;
    player.position.z += vz;
  }

  // === 自适应窗口 ===
  window.addEventListener('resize', () => {
    const w = window.innerWidth;
    const h = window.innerHeight;
    camera.aspect = w / h;
    camera.updateProjectionMatrix();
    renderer.setSize(w, h);
  });

  // === 动画循环 ===
  function animate() {
    requestAnimationFrame(animate);
    updatePlayer();
    controls.update();
    renderer.render(scene, camera);
  }
  animate();
</script>
</body>
</html>
